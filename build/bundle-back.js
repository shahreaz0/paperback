!function(e){var o={};function t(r){if(o[r])return o[r].exports;var n=o[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,t),n.l=!0,n.exports}t.m=e,t.c=o,t.d=function(e,o,r){t.o(e,o)||Object.defineProperty(e,o,{enumerable:!0,get:r})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,o){if(1&o&&(e=t(e)),8&o)return e;if(4&o&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(t.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&o&&"string"!=typeof e)for(var n in e)t.d(r,n,function(o){return e[o]}.bind(null,n));return r},t.n=function(e){var o=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(o,"a",o),o},t.o=function(e,o){return Object.prototype.hasOwnProperty.call(e,o)},t.p="",t(t.s=3)}([function(e,o){e.exports=require("express")},function(e,o){e.exports=require("mongoose")},function(e,o,t){const r=t(1),n=r.Schema({name:{type:String,required:!0}});e.exports=r.model("Author",n)},function(e,o,t){e.exports=t(4)},function(e,o,t){const r=t(5),n=t(14),i=t(15);var s=process.env.PORT||"3000";r.set("port",s),n.createServer(r).listen(s,()=>{console.log(i.blue("======================")),console.log(i.bold("Listening at port "+i.bold.red(s))),console.log(i.blue("======================"))})},function(e,o,t){(function(o){const r=t(6),n=t(0);t(7);const i=t(9),s=t(10),u=t(11),c=n();c.set("views",r.join(o,"./../views")),c.set("view engine","ejs"),c.use(n.json()),c.use(n.urlencoded({extended:!1})),c.use(n.static(r.join(o,"./../public"))),c.use(i),c.use(s),c.use(u),e.exports=c}).call(this,"src")},function(e,o){e.exports=require("path")},function(e,o,t){t(8).config();const r=t(1);r.connect(process.env.DB_URL,{useNewUrlParser:!0,useUnifiedTopology:!0}).catch(e=>console.log(e));const n=r.connection;n.on("error",e=>console.log(e)),n.once("open",()=>console.log("Connected to mongoose!!"))},function(e,o){e.exports=require("dotenv")},function(e,o,t){const r=t(0).Router();r.get("/",(function(e,o,t){o.render("home",{pageTitle:"Paperback"})})),e.exports=r},function(e,o,t){const r=t(0).Router(),n=t(2);r.get("/authors",async(e,o)=>{try{let t={};if(e.query.authorName){const o=new RegExp(e.query.authorName,"i");t.name=o}const r=await n.find(t);o.render("authors/index",{pageTitle:"Authors",authors:r,query:e.query.authorName})}catch(e){o.render("error",{error:e})}}),r.get("/authors/new",(e,o)=>{o.render("authors/new",{pageTitle:"Add Author"})}),r.post("/authors",async(e,o)=>{try{if(!e.body.authorName)throw"Enter author name.";const t=new n({name:e.body.authorName});await t.save(),o.redirect("/author")}catch(e){o.render("error",{pageTitle:"Error",error:e,backButton:"/authors/new"})}}),e.exports=r},function(e,o,t){const r=t(0).Router(),n=t(12),i=t(13),s=t(2),u=n({dest:"public/uploads/cover",limits:{fileSize:1e6},fileFilter(e,o,t){o.originalname.match(/\.(jpeg|jpg|png)$/i)||t(new Error("Only image are allowed")),t(null,!0)}});r.get("/books",(e,o)=>{o.render("books/index",{pageTitle:"Books"})}),r.get("/books/new",async(e,o)=>{const t=await s.find({});o.render("books/new",{pageTitle:"Add Book",authors:t})}),r.post("/books",u.single("cover"),async(e,o)=>{const t=["bookTitle","bookDescription","bookPublishDate","bookAuthor"];try{if(t.forEach(o=>{if(!e.body[o])throw"Enter "+o}),!e.file)throw"Select file";const r=new i({title:e.body.bookTitle,description:e.body.bookDescription,publishDate:e.body.bookPublishDate,author:e.body.bookAuthor,bookCoverName:e.file.filename});await r.save(),o.send(r)}catch(e){o.render("error",{pageTitle:"Error",error:e,backButton:"/books/new"})}}),e.exports=r},function(e,o){e.exports=require("multer")},function(e,o,t){const r=t(1),n=r.Schema({title:{type:String,required:!0},description:{type:String,required:!0},publishDate:{type:Date,required:!0},bookCoverName:{type:String,required:!0},author:{type:r.Schema.Types.ObjectId,ref:"Author"}},{timestamps:!0});e.exports=r.model("Book",n)},function(e,o){e.exports=require("http")},function(e,o){e.exports=require("chalk")}]);