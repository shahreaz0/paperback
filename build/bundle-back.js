!function(e){var o={};function r(t){if(o[t])return o[t].exports;var n=o[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=e,r.c=o,r.d=function(e,o,t){r.o(e,o)||Object.defineProperty(e,o,{enumerable:!0,get:t})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,o){if(1&o&&(e=r(e)),8&o)return e;if(4&o&&"object"==typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(r.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&o&&"string"!=typeof e)for(var n in e)r.d(t,n,function(o){return e[o]}.bind(null,n));return t},r.n=function(e){var o=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(o,"a",o),o},r.o=function(e,o){return Object.prototype.hasOwnProperty.call(e,o)},r.p="",r(r.s=5)}([function(e,o){e.exports=require("express")},function(e,o){e.exports=require("path")},function(e,o){e.exports=require("mongoose")},function(e,o,r){const t=r(2),n=r(1),i=t.Schema({title:{type:String,required:!0},description:{type:String,required:!0},publishDate:{type:Date,required:!0},coverName:{type:String,required:!0},author:{type:t.Schema.Types.ObjectId,ref:"Author"}},{timestamps:!0});i.virtual("imagePath").get((function(){if(book=this,book.coverName)return n.join("uploads","cover",book.coverName)})),e.exports=t.model("Book",i)},function(e,o,r){const t=r(2),n=t.Schema({name:{type:String,required:!0}});e.exports=t.model("Author",n)},function(e,o,r){e.exports=r(6)},function(e,o,r){const t=r(7),n=r(15),i=r(16);var u=process.env.PORT||"3000";t.set("port",u),n.createServer(t).listen(u,()=>{console.log(i.blue("======================")),console.log(i.bold("Listening at port "+i.bold.red(u))),console.log(i.blue("======================"))})},function(e,o,r){const t=r(1),n=r(0);r(8);const i=r(10),u=r(11),s=r(12),c=n();c.set("views",t.join("views")),c.set("view engine","ejs"),c.use(n.json()),c.use(n.urlencoded({extended:!1})),c.use(n.static(t.join("public"))),c.use(i),c.use(u),c.use(s),e.exports=c},function(e,o,r){r(9).config();const t=r(2);t.connect(process.env.DB_URL,{useNewUrlParser:!0,useUnifiedTopology:!0}).catch(e=>console.log(e));const n=t.connection;n.on("error",e=>console.log(e)),n.once("open",()=>console.log("Connected to mongoose!!"))},function(e,o){e.exports=require("dotenv")},function(e,o,r){const t=r(0),n=r(3),i=t.Router();i.get("/",async(e,o)=>{try{const e=await n.find().sort({publishDate:"desc"}).limit(10).exec();o.render("home",{pageTitle:"Paperback",books:e})}catch(e){o.render("error",{pageTitle:"Error",backButton:"/"})}}),e.exports=i},function(e,o,r){const t=r(0).Router(),n=r(4);t.get("/authors",async(e,o)=>{try{let r={};if(e.query.authorName){const o=new RegExp(e.query.authorName,"i");r.name=o}const t=await n.find(r);o.render("authors/index",{pageTitle:"Authors",authors:t,query:e.query.authorName})}catch(e){o.render("error",{error:e})}}),t.get("/authors/new",(e,o)=>{o.render("authors/new",{pageTitle:"Add Author"})}),t.post("/authors",async(e,o)=>{try{if(!e.body.authorName)throw"Enter author name.";const r=new n({name:e.body.authorName});await r.save(),o.redirect("/author")}catch(e){o.render("error",{pageTitle:"Error",error:e,backButton:"/authors/new"})}}),e.exports=t},function(e,o,r){const t=r(0).Router(),n=r(13),i=r(14),u=r(1),s=r(3),c=r(4),a=n({dest:"public/uploads/cover",limits:{fileSize:1e6},fileFilter(e,o,r){o.originalname.match(/\.(jpeg|jpg|png)$/i)||r(new Error("Only image are allowed")),r(null,!0)}});t.get("/books",async(e,o)=>{try{let r=s.find();e.query.title&&(r=r.where("title").regex(new RegExp(e.query.title,"i"))),e.query.publishAfter&&(r=r.where("publishDate").gte(e.query.publishAfter)),e.query.publishBefore&&(r=r.where("publishDate").lte(e.query.publishBefore));const t=await r.exec();o.render("books/index",{pageTitle:"Books",searchOptions:e.query,books:t})}catch(e){o.render("error",{backButton:"/books",error:e})}}),t.get("/books/new",async(e,o)=>{const r=await c.find({});o.render("books/new",{pageTitle:"Add Book",authors:r})}),t.post("/books",a.single("cover"),async(e,o)=>{const r=["bookTitle","bookDescription","bookPublishDate","bookAuthor"];try{if(r.forEach(o=>{if(!e.body[o])throw"Enter "+o}),!e.file)throw"Select file";const t=new s({title:e.body.bookTitle,description:e.body.bookDescription,publishDate:e.body.bookPublishDate,author:e.body.bookAuthor,coverName:e.file.filename});await t.save(),o.redirect("/books")}catch(r){i.unlink(u.join("public","uploads","cover",e.file.filename),e=>console.log(e)),o.render("error",{pageTitle:"Error",error:r,backButton:"/books/new"})}}),e.exports=t},function(e,o){e.exports=require("multer")},function(e,o){e.exports=require("fs")},function(e,o){e.exports=require("http")},function(e,o){e.exports=require("chalk")}]);